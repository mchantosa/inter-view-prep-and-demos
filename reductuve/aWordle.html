<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>A Wordle Inspired Game</title>
    <meta charset="UTF-8" />
    <style>/* whitespace reset */
      ul,ol { list-style: none; }
      h1,h2,h3,h4,h5,h6,pre,code { font-size: 1em; }
      ul,ol,li,h1,h2,h3,h4,h5,h6,pre,form,body,html,p,blockquote,fieldset,input,dl,dt,dd, figure, figcaption {
        margin: 0;
        padding: 0; }
      a img,:link img,:visited img, fieldset { border: none; }
      address { font-style: normal; }
      header, section, article, nav, footer, hgroup, details, summary, figure, main { display: block; }
      mark {
        color: inherit;
        background: transparent; }
      abbr { border: none; }
      summary::-webkit-details-marker { display: none; }
    </style>
    <style>/* main */
      html{
        font-size: 16px;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
      }
      #modal {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        z-index: 2;
        background-color:rgba(245, 255, 255, .5);
      }
      #modal-content {
        position:fixed;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 15px;
        top:25%;
        right:25%;
        height:50%;
        width:50%;
        border-radius: 15px;
        background-color:darkslategrey;
        z-index: 3;
        overflow-y:scroll;
        color:azure;
        font-size: 24px;
        /* font-weight: bold; */
      }
      #close{
        display: flex;
        flex-direction: row-reverse;
      }
      #close img{
        width: 30px;
        height: 30px;
      }
      .height-30px{
        height: 30px;
      }
      #modal p{
        text-align: center;
        padding: 0 25px 0 25px;
      }
      #board, #keyboard{
        display: flex;
        justify-content: center;
      }
      #board{
        padding: 0 0 15px 0;
      }
      #board td{
        line-height: 48px;
        text-align: center;
        height: 45px;
        width: 45px;
        background-color: lightgray;
        margin: 3px;
        display: inline-block;
      }
      #keyboard td{
        line-height: 50px;
        text-align: center;
        height: 50px;
        width: 45px;
        border-radius: 5px;
        background-color:rgb(25, 25, 25);
        color: lightgrey;
        margin: 2px;
        display: inline-block;
      }
      #keyboard td.special{
        width: 96px;
      }
      #keyboard tr{
        display: flex;
        justify-content: center;
      }
      h1{
        font-size: 28px;
        text-align: center;
        padding: 0 0 5px 0;
      }
      h2{
        font-size: 24px;
        text-align: center;
        padding: 0 0 15px 0;
      }
    </style>
     <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
  </head>
  <body>
    <h1>Greetings Hooman</h1>
    <h2>A Wordle inspired game</h2>
    <div id="board">
      <table>
      
      </table>
    </div>
    <div id="keyboard">
      <table>
      
      </table>
    </div>
  </body>
  <script>
    function htmlToElement(html) {
      const template = document.createElement('template');
      html = html.trim();
      template.innerHTML = html;
      return template.content.firstChild;
    }

    const modalTemplate = Handlebars.compile(
      `<div id="modal">
        <div id="modal-content">
          <div>
            <a href="#" id="close">
              <img src="icon_close.png" alt="close"/>
            </a>
          </div>
          <p>{{message}}</p>
          <div class="height-30px"></div>
        </div>
      </div>`
    );

    class Wordle {
      static LETTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      
      constructor() {}

      static async getRandomWord() {
        let word;
        while (true){
          const response = await fetch("https://random-word-api.herokuapp.com/word?length=5");
          const jsonData = await response.json();
          word = jsonData[0]
          if(await this.isWord(word)){
            break;
          }
        }
        return word;
      }

      static async isWord(word){
        const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
        return response.status !== 404
      }

      toggleWord(index, className){
        this.board.children[index].classList.toggle(className)
      }

      toggleCell(index, className){
        if(index<5){
          this.board
          .children[this.activeWordIndex]
          .children[index].classList.toggle(className)
        }
        
      }

      advanceActiveWord(){
        if(!this.activeWordIndex && this.activeWordIndex!== 0){
          this.activeWordIndex = 0;
          this.toggleWord(0, 'active')
        } else {
          this.toggleCell(5, 'active')
          delete this.activeCellIndex;
          this.toggleWord(this.activeWordIndex, 'active')
          this.activeWordIndex++;
          this.toggleWord(this.activeWordIndex, 'active')
        } 
        this.advanceActiveCell()
      }

      advanceActiveCell(){
        if(!this.activeCellIndex && this.activeCellIndex!== 0){
          this.activeCellIndex = 0;
          this.toggleCell(0, 'active')
        } else {
          this.toggleCell(this.activeCellIndex, 'active')
          this.activeCellIndex++;
          this.toggleCell(this.activeCellIndex, 'active')
        }
      }

      getActiveWord(){
        return this.board.children[this.activeWordIndex]
      }

      getActiveCell(){
        return this.board.children[this.activeWordIndex].children[this.activeCellIndex];
      }

      getActiveWordWord(){
        let word = ''
        const activeWord = this.getActiveWord()
        for (const cell of activeWord.children){
          word += cell.textContent.trim()
        }
        return word;
      }

      async setBoard() {
        this.word = await Wordle.getRandomWord();
        this.lettersNotTried = Wordle.LETTERS.split('');
        this.lettersIn = [];
        this.lettersOut = [];
        this.attempts = [];

        this.body = document.querySelector('body');

        this.board = document.querySelector('#board table');
        const wordTemplate =` <tr>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
  <td></td>
</tr>`;
        this.board.innerHTML = ''
        for(let i = 0; i < 6; i++){
          this.board.append(htmlToElement(wordTemplate));
        }
        this.advanceActiveWord();

        this.keyboard = document.querySelector('#keyboard table');
        this.keyboard.innerHTML = '';
        const keyboardTemplate = ` <tr>
  <td>Q</td>
  <td>W</td>
  <td>E</td>
  <td>R</td>
  <td>T</td>
  <td>Y</td>
  <td>U</td>
  <td>I</td>
  <td>O</td>
  <td>P</td>
</tr>
<tr>
  <td>A</td>
  <td>S</td>
  <td>D</td>
  <td>F</td>
  <td>G</td>
  <td>H</td>
  <td>J</td>
  <td>K</td>
  <td>L</td>
</tr>
<tr>
  <td>Z</td>
  <td>X</td>
  <td>C</td>
  <td>V</td>
  <td>B</td>
  <td>N</td>
  <td>M</td>
</tr>
<tr>
  <td class="special">Enter</td>
  <td class="special">Back</td>
</tr>`;
        this.keyboard.innerHTML=keyboardTemplate;
      }

      updateBoard(){
        console.log('board updated')
      }

      processLetter(letter){
        if(this.activeCellIndex < 5){
          const cell = this.getActiveCell();
          cell.textContent = letter;
          this.advanceActiveCell();
        }
      }

      makeModal(msg){
        const template = modalTemplate({message: msg});
        this.body.append(htmlToElement(template))
        const modal = this.body.querySelector('#modal');
        const close = this.body.querySelector('#close');
        close.addEventListener('click', (e) => {
          e.preventDefault();
          modal.remove();
        })
      }

      processBack(){
        if(this.activeCellIndex >= 5){
          this.toggleCell(4, 'active')
          this.activeCellIndex = 4
          this.getActiveCell().textContent = '';
        } else if (this.activeCellIndex){
          this.toggleCell(this.activeCellIndex, 'active')
          this.activeCellIndex--;
          this.toggleCell(this.activeCellIndex, 'active')
          this.getActiveCell().textContent = '';
        }
      }

      async processEnter(){
        const word = this.getActiveWordWord();
        if(word.length<5){
          this.makeModal('Your word must be 5 letters');
        } else if(!await Wordle.isWord(word)) {
          this.makeModal('Please enter a valid word');  
        } else {
          this.updateBoard();
        }
      }

      async play() {
        await this.setBoard();
        console.log(this.word)
        this.keyboard.addEventListener('click', async (e) => {
          const clicked = e.target;
          if(clicked.tagName === 'TD'){
            const buttonContent = clicked.textContent.trim();
            if (buttonContent === 'Enter') await this.processEnter()
            else if(buttonContent === 'Back') this.processBack()
            else this.processLetter(buttonContent)
          }
        })
        while (true) {
          break;
        }
      }
    }

    
    document.addEventListener('DOMContentLoaded', async () => {
      console.log("document loaded...");
      const wordle = new Wordle();
      await wordle.play();
      
    })
  </script>
</html>